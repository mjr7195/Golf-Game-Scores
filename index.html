<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Golf Score Tracker</title>
  <style>
    /* ---------- Basic reset ---------- */
    * { box-sizing: border-box; }
    html,body { height:100%; margin:0; font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial; background:#f7f7f8; color:#111; }
    button { font:inherit; cursor:pointer; }

    /* ---------- Layout ---------- */
    .container { max-width:900px; margin:20px auto; background:white; border:1px solid #e3e3e6; border-radius:10px; padding:20px; box-shadow: 0 4px 14px rgba(15,15,20,0.04); }
    header { text-align:center; margin-bottom:18px; }
    h1 { margin:6px 0 0; font-size:28px; letter-spacing:0.2px; }

    /* ---------- Primary buttons ---------- */
    .top-actions { display:flex; gap:12px; justify-content:center; margin:16px 0 24px; }
    .btn { padding:12px 18px; border-radius:10px; border:1px solid #cfcfd6; background:#fff; min-width:150px; text-align:center; box-shadow:none; }
    .btn-primary { background:#111827; color:white; border:none; }
    .btn-ghost { background:transparent; border:1px solid #111827; color:#111827; }

    /* ---------- Form / setup ---------- */
    .panel { border:1px solid #e6e6ea; border-radius:10px; padding:16px; margin-bottom:16px; }
    label { display:block; font-weight:600; margin-bottom:6px; }
    .row { display:flex; gap:16px; align-items:center; flex-wrap:wrap; }
    input[type="text"], select, input[type="number"] {
      padding:10px 12px; border-radius:8px; border:1px solid #d0d0d6; min-width:0; width:100%;
    }
    .player-inputs { margin-top:12px; display:grid; gap:8px; grid-template-columns: 1fr 1fr; }
    .player-inputs .full { grid-column:1/-1; }

    /* ---------- Game screen ---------- */
    .game-header { display:flex; justify-content:space-between; align-items:center; margin-bottom:12px; gap:12px; flex-wrap:wrap; }
    .small { font-size:14px; color:#3a3a45; }

    .score-table { width:100%; border-collapse:collapse; margin-bottom:12px; }
    .score-table th, .score-table td { border:1px solid #e6e6ea; padding:10px; text-align:left; vertical-align:middle; }
    .score-table th { background:#fafafa; font-weight:700; }

    .score-controls { display:flex; gap:8px; align-items:center; }
    .small-btn { padding:6px 10px; border-radius:8px; border:1px solid #cfcfd6; background:white; min-width:36px; text-align:center; }
    .score-input { width:62px; padding:6px 8px; border-radius:8px; text-align:center; border:1px solid #d0d0d6; }

    .nav-row { display:flex; justify-content:space-between; gap:12px; margin-top:10px; flex-wrap:wrap; }
    .muted { color:#6b6b73; font-size:14px; }

    /* ---------- Final card ---------- */
    .final { margin-top:12px; }
    .final .player { display:flex; justify-content:space-between; padding:8px 10px; border-radius:8px; border:1px solid #eee; margin-bottom:8px; background:#fcfcfd; }

    /* ---------- Past games ---------- */
    .past-list { display:grid; gap:10px; }
    .past-item { display:flex; justify-content:space-between; align-items:center; padding:10px; border-radius:8px; border:1px solid #eee; background:#fff; }
    .past-meta { display:flex; gap:12px; align-items:center; }

    /* ---------- Utilities ---------- */
    .hidden { display:none; }
    .flex { display:flex; gap:12px; align-items:center; }
    .right { margin-left:auto; }
    @media (max-width:640px) {
      .player-inputs { grid-template-columns: 1fr; }
      .top-actions { flex-direction:column; }
      .game-header { flex-direction:column; align-items:flex-start; }
    }
  </style>
</head>
<body>
  <div class="container" role="application" aria-label="Golf Score Tracker">
    <header>
      <h1>Golf Score Tracker</h1>
      <div class="top-actions" aria-hidden="false">
        <button class="btn btn-primary" id="start-new-btn">Start New Game</button>
        <button class="btn" id="view-past-btn">View Past Games</button>
      </div>
    </header>

    <!-- ---------- New Game Setup Panel ---------- -->
    <section id="setup-panel" class="panel">
      <h2 style="margin-top:0">New Game Setup</h2>
      <div class="row">
        <div style="flex:1; min-width:180px;">
          <label for="course-name">Enter Course Name</label>
          <input id="course-name" type="text" placeholder="e.g., Pine Valley" />
        </div>
        <div style="width:160px;">
          <label for="num-players">Number of Players</label>
          <select id="num-players" aria-label="Number of players">
            <option value="1">1 Player</option>
            <option value="2" selected>2 Players</option>
            <option value="3">3 Players</option>
            <option value="4">4 Players</option>
          </select>
        </div>
      </div>

      <div class="player-inputs" id="player-inputs">
        <div class="full">
          <label for="player1">Player 1</label>
          <input id="player1" type="text" placeholder="Player 1 name" />
        </div>
        <div>
          <label for="player2">Player 2</label>
          <input id="player2" type="text" placeholder="Player 2 name" />
        </div>
        <div>
          <label for="player3">Player 3</label>
          <input id="player3" type="text" placeholder="Player 3 name" />
        </div>
        <div>
          <label for="player4">Player 4</label>
          <input id="player4" type="text" placeholder="Player 4 name" />
        </div>
      </div>

      <div style="display:flex; align-items:center; justify-content:space-between; margin-top:12px;">
        <div class="muted">Hole: <span id="setup-hole">1/18</span></div>
        <div>
          <button class="btn btn-primary" id="start-game">Start Game</button>
        </div>
      </div>
    </section>

    <!-- ---------- Game Panel ---------- -->
    <section id="game-panel" class="panel hidden" aria-live="polite">
      <div class="game-header">
        <div>
          <div class="small">Course: <strong id="course-display">—</strong></div>
          <div class="small">Hole: <strong id="hole-display">1/18</strong></div>
        </div>
        <div class="flex">
          <div class="muted">Players: <span id="players-count">0</span></div>
          <div class="right" style="display:flex; gap:8px;">
            <button class="btn" id="save-progress">Save Progress</button>
            <button class="btn" id="end-game">End Game</button>
          </div>
        </div>
      </div>

      <table class="score-table" aria-describedby="score-desc">
        <caption id="score-desc" class="hidden">Score entry table. Use + and - to change strokes, or type directly.</caption>
        <thead>
          <tr>
            <th>Player</th>
            <th style="width:320px">Score Entry</th>
            <th style="width:80px">Hole Total</th>
          </tr>
        </thead>
        <tbody id="score-body">
          <!-- populated dynamically -->
        </tbody>
      </table>

      <div class="nav-row">
        <div>
          <button class="btn" id="prev-hole">&larr; Previous Hole</button>
        </div>
        <div>
          <button class="btn" id="next-hole">Next Hole &rarr;</button>
        </div>
      </div>

      <div id="final-card" class="final hidden" aria-live="polite">
        <h3>Final Scorecard</h3>
        <div id="final-list"></div>
        <div style="display:flex; gap:8px; margin-top:8px;">
          <button class="btn btn-primary" id="save-game">Save Game</button>
          <button class="btn" id="back-to-home">Back to Home</button>
        </div>
      </div>
    </section>

    <!-- ---------- Past Games Panel ---------- -->
    <section id="past-panel" class="panel hidden">
      <h2 style="margin-top:0">Past Games</h2>
      <div class="past-list" id="past-list"></div>
      <div style="margin-top:10px;">
        <button class="btn" id="back-home-2">Back to Home</button>
      </div>
    </section>
  </div>

  <script>
    /* =========================
       Data model & persistence
       ========================= */
    const STORAGE_KEY = 'golf_score_tracker_games_v1';
    const TEMP_KEY = 'golf_score_tracker_current_game_v1';

    // Load saved games array from localStorage
    function loadSavedGames() {
      try {
        const raw = localStorage.getItem(STORAGE_KEY);
        return raw ? JSON.parse(raw) : [];
      } catch (e) {
        console.error('Failed to parse saved games', e);
        return [];
      }
    }
    function saveGames(games) {
      localStorage.setItem(STORAGE_KEY, JSON.stringify(games));
    }

    // Save/load in-progress game to temporary slot (autosave)
    function saveTempGame(game) {
      localStorage.setItem(TEMP_KEY, JSON.stringify(game));
    }
    function loadTempGame() {
      const raw = localStorage.getItem(TEMP_KEY);
      return raw ? JSON.parse(raw) : null;
    }
    function clearTempGame() {
      localStorage.removeItem(TEMP_KEY);
    }

    /* =========================
       App state
       ========================= */
    let appState = {
      currentGame: null, // game object while playing
      currentHole: 1 // 1..18
    };

    // A game object structure:
    // {
    //   id: timestamp (ms),
    //   courseName: string,
    //   createdAt: ISO string,
    //   players: [ { name: string, scores: [18 ints], total: int } ],
    //   finished: boolean
    // }

    /* =========================
       DOM refs
       ========================= */
    const setupPanel = document.getElementById('setup-panel');
    const gamePanel = document.getElementById('game-panel');
    const pastPanel = document.getElementById('past-panel');

    const startNewBtn = document.getElementById('start-new-btn');
    const viewPastBtn = document.getElementById('view-past-btn');

    const courseNameInput = document.getElementById('course-name');
    const numPlayersSelect = document.getElementById('num-players');
    const playerInputs = document.getElementById('player-inputs');
    const startGameBtn = document.getElementById('start-game');
    const setupHoleSpan = document.getElementById('setup-hole');

    const courseDisplay = document.getElementById('course-display');
    const holeDisplay = document.getElementById('hole-display');
    const playersCountSpan = document.getElementById('players-count');

    const scoreBody = document.getElementById('score-body');
    const prevHoleBtn = document.getElementById('prev-hole');
    const nextHoleBtn = document.getElementById('next-hole');
    const endGameBtn = document.getElementById('end-game');
    const saveGameBtn = document.getElementById('save-game');
    const saveProgressBtn = document.getElementById('save-progress');
    const finalCard = document.getElementById('final-card');
    const finalList = document.getElementById('final-list');
    const backToHomeBtn = document.getElementById('back-to-home');

    const pastList = document.getElementById('past-list');
    const viewPastPanelBtn = document.getElementById('view-past-btn');
    const backHome2Btn = document.getElementById('back-home-2');

    /* =========================
       Setup UI logic
       ========================= */
    // Show/hide number of player inputs
    function adjustPlayerInputs() {
      const n = parseInt(numPlayersSelect.value, 10);
      const inputs = [1,2,3,4].map(i => document.getElementById('player' + i));
      inputs.forEach((el, idx) => {
        el.parentElement.style.display = (idx < n) ? 'block' : 'none';
        if (idx >= n) el.value = '';
      });
    }
    numPlayersSelect.addEventListener('change', adjustPlayerInputs);
    adjustPlayerInputs();

    /* =========================
       New game creation
       ========================= */
    startGameBtn.addEventListener('click', () => {
      const course = courseNameInput.value.trim() || 'Unknown Course';
      const numPlayers = parseInt(numPlayersSelect.value, 10);
      const players = [];
      for (let i=1; i<=numPlayers; i++) {
        const name = (document.getElementById('player' + i).value.trim() || `Player ${i}`);
        players.push({ name, scores: Array(18).fill(null) }); // null scores until filled
      }

      const game = {
        id: Date.now(),
        courseName: course,
        createdAt: new Date().toISOString(),
        players,
        finished: false
      };
      // set app state and show game panel
      appState.currentGame = game;
      appState.currentHole = 1;
      saveTempGame(game);
      showGamePanel();
    });

    /* =========================
       UI view toggles
       ========================= */
    function hideAllPanels() {
      setupPanel.classList.add('hidden');
      gamePanel.classList.add('hidden');
      pastPanel.classList.add('hidden');
    }
    function showSetupPanel() {
      hideAllPanels();
      setupPanel.classList.remove('hidden');
    }
    function showGamePanel() {
      hideAllPanels();
      gamePanel.classList.remove('hidden');
      renderGame();
    }
    function showPastPanel() {
      hideAllPanels();
      pastPanel.classList.remove('hidden');
      renderPastList();
    }

    startNewBtn.addEventListener('click', () => {
      // If there's a temp game, ask the user if they'd like to resume
      const temp = loadTempGame();
      if (temp) {
        if (confirm('Resume last in-progress game?')) {
          appState.currentGame = temp;
          appState.currentHole = findFirstUnfilledHole(temp) || 1;
          showGamePanel();
          return;
        } else {
          clearTempGame();
        }
      }
      showSetupPanel();
    });

    viewPastBtn.addEventListener('click', () => showPastPanel());
    viewPastPanelBtn.addEventListener('click', () => showPastPanel());
    backHome2Btn.addEventListener('click', () => {
      showSetupPanel();
    });

    /* =========================
       Game rendering & controls
       ========================= */
    function renderGame() {
      const g = appState.currentGame;
      if (!g) { showSetupPanel(); return; }
      courseDisplay.textContent = g.courseName;
      holeDisplay.textContent = `${appState.currentHole}/18`;
      playersCountSpan.textContent = g.players.length;

      // Build table rows
      scoreBody.innerHTML = '';
      g.players.forEach((p, pIndex) => {
        const tr = document.createElement('tr');

        // Player name cell
        const nameTd = document.createElement('td');
        nameTd.textContent = p.name;
        tr.appendChild(nameTd);

        // Score entry cell
        const entryTd = document.createElement('td');
        const controls = document.createElement('div');
        controls.className = 'score-controls';

        const minusBtn = document.createElement('button');
        minusBtn.className = 'small-btn';
        minusBtn.type = 'button';
        minusBtn.setAttribute('aria-label', `Decrease ${p.name} score`);
        minusBtn.textContent = '-';
        minusBtn.addEventListener('click', () => changeScore(pIndex, appState.currentHole, -1));

        const plusBtn = document.createElement('button');
        plusBtn.className = 'small-btn';
        plusBtn.type = 'button';
        plusBtn.setAttribute('aria-label', `Increase ${p.name} score`);
        plusBtn.textContent = '+';
        plusBtn.addEventListener('click', () => changeScore(pIndex, appState.currentHole, +1));

        const input = document.createElement('input');
        input.className = 'score-input';
        input.type = 'number';
        input.min = 0;
        input.setAttribute('aria-label', `${p.name} strokes for hole ${appState.currentHole}`);
        const current = p.scores[appState.currentHole - 1];
        input.value = (current === null || current === undefined) ? '' : current;
        // When user types directly
        input.addEventListener('change', (e) => {
          const val = e.target.value;
          if (val === '') {
            p.scores[appState.currentHole - 1] = null;
          } else {
            const num = parseInt(val, 10);
            p.scores[appState.currentHole - 1] = isNaN(num) ? null : Math.max(0, num);
          }
          saveTempGame(appState.currentGame);
          renderGame(); // re-render to update totals
        });

        controls.appendChild(minusBtn);
        controls.appendChild(plusBtn);
        controls.appendChild(input);
        entryTd.appendChild(controls);
        tr.appendChild(entryTd);

        // Hole total for player (just the score for this hole)
        const totalTd = document.createElement('td');
        const holeScore = p.scores[appState.currentHole - 1];
        totalTd.textContent = (holeScore === null || holeScore === undefined || holeScore === '') ? '-' : holeScore;
        tr.appendChild(totalTd);

        scoreBody.appendChild(tr);
      });

      // Show / hide final card depending on finished state
      if (appState.currentGame.finished) {
        showFinalCard();
      } else {
        finalCard.classList.add('hidden');
      }
    }

    // find first unfilled hole index to resume
    function findFirstUnfilledHole(game) {
      for (let h=0; h<18; h++) {
        const anyScore = game.players.some(p => p.scores[h] !== null && p.scores[h] !== undefined && p.scores[h] !== '');
        if (!anyScore) return h+1;
      }
      return 18;
    }

    function changeScore(playerIndex, holeNumber, delta) {
      const p = appState.currentGame.players[playerIndex];
      const idx = holeNumber - 1;
      let current = p.scores[idx];
      if (current === null || current === undefined || current === '') current = 0;
      let next = parseInt(current, 10) + delta;
      if (isNaN(next) || next < 0) next = 0;
      p.scores[idx] = next;
      saveTempGame(appState.currentGame);
      renderGame();
    }

    prevHoleBtn.addEventListener('click', () => {
      if (appState.currentHole > 1) {
        appState.currentHole--;
        renderGame();
      } else {
        alert('This is the first hole.');
      }
    });
    nextHoleBtn.addEventListener('click', () => {
      if (appState.currentHole < 18) {
        appState.currentHole++;
        renderGame();
      } else {
        alert('That was the final hole. You can End Game to see the final scorecard.');
      }
    });

    saveProgressBtn.addEventListener('click', () => {
      if (!appState.currentGame) return;
      saveTempGame(appState.currentGame);
      alert('Progress saved locally.');
    });

    /* =========================
       Ending & saving games
       ========================= */
    endGameBtn.addEventListener('click', () => {
      if (!appState.currentGame) return;
      // Mark game finished
      appState.currentGame.finished = true;
      // convert nulls to 0 for any missing holes (optional)
      appState.currentGame.players.forEach(p => {
        p.scores = p.scores.map(s => (s === null || s === undefined || s === '') ? 0 : s);
      });
      saveTempGame(appState.currentGame);
      showFinalCard();
    });

    function showFinalCard() {
      const g = appState.currentGame;
      if (!g) return;
      finalCard.classList.remove('hidden');
      finalList.innerHTML = '';
      // compute totals
      const leaderboard = g.players.map(p => {
        const total = p.scores.reduce((a,b) => a + (Number(b) || 0), 0);
        return { name: p.name, total, scores: p.scores.slice() };
      }).sort((a,b) => a.total - b.total);

      // Display sorted or original order? we show original order with totals too
      g.players.forEach(p => {
        const total = p.scores.reduce((a,b) => a + (Number(b) || 0), 0);
        const div = document.createElement('div');
        div.className = 'player';
        div.innerHTML = `<div style="font-weight:700">${p.name}</div><div style="min-width:60px;text-align:right">${total}</div>`;
        finalList.appendChild(div);
      });

      // also show winner
      const winner = leaderboard[0];
      const winnerNote = document.createElement('div');
      winnerNote.style.marginTop = '8px';
      winnerNote.className = 'muted';
      winnerNote.textContent = `Lowest score wins — current leader: ${winner.name} (${winner.total})`;
      finalList.appendChild(winnerNote);
    }

    // Save game permanently to saved list
    saveGameBtn.addEventListener('click', () => {
      const g = appState.currentGame;
      if (!g) return;
      const games = loadSavedGames();
      // Add createdAt if missing
      if (!g.createdAt) g.createdAt = new Date().toISOString();
      g.savedAt = new Date().toISOString();
      // compute totals for convenience
      g.players.forEach(p => {
        p.total = p.scores.reduce((a,b) => a + (Number(b) || 0), 0);
      });
      games.push(g);
      saveGames(games);
      clearTempGame();
      alert('Game saved locally.');
      // Reset to fresh state
      appState.currentGame = null;
      appState.currentHole = 1;
      showSetupPanel();
    });

    backToHomeBtn.addEventListener('click', () => {
      // keep progress in temp store; just go home
      showSetupPanel();
    });

    /* =========================
       Past games UI
       ========================= */
    function renderPastList() {
      const games = loadSavedGames().slice().reverse(); // newest first
      pastList.innerHTML = '';
      if (games.length === 0) {
        const none = document.createElement('div');
        none.className = 'muted';
        none.textContent = 'No saved games yet.';
        pastList.appendChild(none);
        return;
      }
      games.forEach((g) => {
        const item = document.createElement('div');
        item.className = 'past-item';
        const meta = document.createElement('div');
        meta.className = 'past-meta';
        const title = document.createElement('div');
        title.innerHTML = `<strong>${g.courseName}</strong><div class="muted" style="font-size:13px">${(new Date(g.savedAt||g.createdAt)).toLocaleString()}</div>`;
        const players = document.createElement('div');
        players.className = 'muted';
        players.textContent = `${g.players.length} players`;
        meta.appendChild(title);
        meta.appendChild(players);

        const controls = document.createElement('div');
        controls.style.display = 'flex';
        controls.style.gap = '8px';
        const loadBtn = document.createElement('button');
        loadBtn.className = 'btn';
        loadBtn.textContent = 'Load';
        loadBtn.addEventListener('click', () => {
          if (confirm('Load this game into the current session? Unsaved progress will be replaced.')) {
            appState.currentGame = g;
            appState.currentHole = 1;
            saveTempGame(g); // make it current temp as well
            showGamePanel();
          }
        });

        const deleteBtn = document.createElement('button');
        deleteBtn.className = 'btn';
        deleteBtn.textContent = 'Delete';
        deleteBtn.addEventListener('click', () => {
          if (!confirm('Delete this saved game? This cannot be undone.')) return;
          const saved = loadSavedGames();
          const idx = saved.findIndex(s => s.id === g.id);
          if (idx >= 0) {
            saved.splice(idx,1);
            saveGames(saved);
            renderPastList();
          }
        });

        controls.appendChild(loadBtn);
        controls.appendChild(deleteBtn);

        item.appendChild(meta);
        item.appendChild(controls);
        pastList.appendChild(item);
      });
    }

    /* =========================
       Boot: load temp if exists
       ========================= */
    function boot() {
      // If there's an in-progress game, show resume prompt once (or show setup)
      const temp = loadTempGame();
      if (temp) {
        if (confirm('You have an in-progress game. Resume it?')) {
          appState.currentGame = temp;
          appState.currentHole = findFirstUnfilledHole(temp) || 1;
          showGamePanel();
          return;
        } else {
          clearTempGame();
        }
      }
      showSetupPanel();
    }

    // initialize UI listeners for accessibility / small things
    document.addEventListener('keydown', (e) => {
      if (e.key === 'ArrowRight' && !gamePanel.classList.contains('hidden')) {
        nextHoleBtn.click();
      } else if (e.key === 'ArrowLeft' && !gamePanel.classList.contains('hidden')) {
        prevHoleBtn.click();
      }
    });

    // Run boot
    boot();

    /* =========================
       Developer notes & extension points:
       - To add per-hole par or yardage, add fields to the game.players or game.course object.
       - To support 9-hole rounds, allow user to pick #holes at setup and change arrays accordingly.
       - To export or share games, implement JSON download or CSV generation from saved games array.
       ========================= */
  </script>
</body>
</html>